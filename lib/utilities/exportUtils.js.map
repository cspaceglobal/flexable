{"version":3,"sources":["../../src/utilities/exportUtils.js"],"names":[],"mappings":";;;;;QAEgB;QAUA;QAMA;QAOA;;AAzBhB;;AAEO,SAAS,kBAAT,CAA4B,iBAA5B,EAA+C,sBAA/C,EAAuE,IAAvE,EAA6E,OAA7E,EAA+J;QAAzE,mEAAa,gCAA4D;QAA1C,wEAAkB,sCAAwB;QAC5J,UAAuB,QAAvB,QAD4J;QACnJ,YAAc,QAAd,UADmJ;;AAElK,gBAAY,YAAY,SAAZ,GAAwB,GAAxB,CAFsJ;AAGlK,QAAI,SAAS,YAAY,KAAZ,GAAqB,EAArB,GAAyB,GAAzB,CAHqJ;AAIlK,QAAM,SAAY,gBAAgB,sBAAhB,EAAwC,SAAxC,UAAZ,CAJ4J;AAKlK,QAAM,OAAO,KAAK,GAAL,CAAS;eAAK,WAAW,CAAX,EAAc,iBAAd,EAAiC,SAAjC;KAAL,CAAT,CAA2D,IAA3D,CAAgE,MAAhE,CAAP,CAL4J;AAMlK,kBAAY,SAAS,SAAS,IAA9B,CANkK;AAOlK,WAAO,MAAP,CAPkK;CAA/J;;AAUA,SAAS,gBAAT,CAA0B,GAA1B,EAA+B,iBAA/B,EAAkD,SAAlD,EAA6D;AAChE,WAAO,kBACF,GADE,CACE;eAAK,uBAAuB,EAAE,WAAF,CAAc,GAAd,CAAvB,EAA2C,SAA3C;KAAL,CADF,CAEF,IAFE,CAEG,SAFH,CAAP,CADgE;CAA7D;;AAMA,SAAS,sBAAT,CAAgC,sBAAhC,EAAwD,SAAxD,EAAmE;AACtE,WAAO,uBACF,GADE,CACE;eAAK,uBAAuB,EAAE,gBAAF,EAAoB,SAA3C;KAAL,CADF,CAEF,IAFE,CAEG,SAFH,CAAP,CADsE;CAAnE;;;AAOA,SAAS,sBAAT,CAAgC,MAAhC,EAAyD;QAAjB,kEAAY,mBAAK;;AAC5D,QAAI,SAAS,MAAT,CADwD;AAE5D,QAAM,QAAQ,GAAR,CAFsD;AAG5D,QAAM,eAAe,IAAf,CAHsD;AAI5D,QAAM,gBAAgB,CAAC,SAAD,EAAY,KAAZ,EAAmB,IAAnB,EAAyB,MAAzB,CAAhB,CAJsD;AAK5D,aAAS,OAAO,MAAP,EAAe,OAAf,CAAuB,IAAI,MAAJ,MAAc,KAAd,EAAuB,GAAvB,CAAvB,EAAoD,YAApD,CAAT,CAL4D;;AAO5D,QAAI,oCAAkB,MAAlB,EAA0B,aAA1B,CAAJ,EAA8C;AAC1C,sBAAY,QAAQ,SAAS,KAA7B,CAD0C;KAA9C;;AAIA,WAAO,MAAP;AAX4D,CAAzD","file":"exportUtils.js","sourcesContent":["import { stringContainsAny } from './stringUtils';\r\n\r\nexport function convertToCsvString(columnDefinitions, columnHeaderDefinition, data, options, formatRows = defaultFormatRow, formatHeaderRow = defaultFormatHeaderRow) {\r\n    let { utf8Bom, delimeter } = options;\r\n    delimeter = delimeter ? delimeter : ',';\r\n    let result = utf8Bom === false  ? '': '\\ufeff';\r\n    const header = `${formatHeaderRow(columnHeaderDefinition, delimeter)}\\r\\n`;\r\n    const rows = data.map(r => formatRows(r, columnDefinitions, delimeter)).join('\\r\\n');\r\n    result = `${result}${header}${rows}`;\r\n    return result;\r\n}\r\n\r\nexport function defaultFormatRow(row, columnDefinitions, delimeter) {\r\n    return columnDefinitions\r\n        .map(d => safeConvertToCsvRecord(d.propertyMap(row), delimeter))\r\n        .join(delimeter);\r\n}\r\n\r\nexport function defaultFormatHeaderRow(columnHeaderDefinition, delimeter) {\r\n    return columnHeaderDefinition\r\n        .map(d => safeConvertToCsvRecord(d.columnHeaderText, delimeter))\r\n        .join(delimeter);\r\n}\r\n\r\n// according to https://tools.ietf.org/html/rfc4180\r\nexport function safeConvertToCsvRecord(record, delimeter = ',') {\r\n    let result = record;\r\n    const quote = '\"';\r\n    const escapedQuote = '\"\"';\r\n    const charsToEscape = [delimeter, quote, '\\n', '\\r\\n'];\r\n    result = String(result).replace(new RegExp(`${quote}`, 'g'), escapedQuote);\r\n\r\n    if (stringContainsAny(result, charsToEscape)) {\r\n        result = `${quote}${result}${quote}`;\r\n    }\r\n\r\n    return result; // isNaN(record) ? `\"${record}\"` : Number(record);\r\n}\r\n"]}